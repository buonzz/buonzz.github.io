<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Use Ioncube HTML Encoder to CodeIgniter</title>
  <!-- meta name="description" content="{"options"=>{}}" -->

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://buonzz.github.io/coding/php/privacy/security/2013/10/13/use-ioncube-html-encoder-to-codeigniter.html">
  <link rel="alternate" type="application/rss+xml" title="Darwin Biler's Blog" href="http://buonzz.github.io/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Darwin Biler's Blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Use Ioncube HTML Encoder to CodeIgniter</h1>
    <p class="post-meta">Oct 13, 2013</p>
  </header>

  <article class="post-content">
    <p>If you want to obfuscate your HTML markup and you want to use the Ioncube's HTML encoder, this is a quickfix on how to make it work at least in CodeIgniter.</p>
<p>These are the versions of the software that I had tested with this setup:</p>
<p>Ubuntu 13.04 - http://www.ubuntu.com/<br />
PHP 5.4.9 http://www.php.net/<br />
CI  2.1.4 - http://ellislab.com/codeigniter<br />
Obfuscating HTML Encoder 1.9 by IonCube - http://www.ioncube.com/html_encoder.php</p>
<p>I'm not sure with other version combinations, but most likely it will work in your end as well.</p>
<blockquote><p><b>Disclaimer:</b> Ok, ok, I know now that PHP 5.3 and 5.4 is coming, there is a lot of new things that comes along. I know CodeIgniter is not maintained anymore and Laravel is taking over already. However, there are tons of web apps there that are still running in CI, and not all company is able to rewrite their whole thing to newer framework. This is for those who will deal with CI, and I emphasize, do not use this instructions when there is a better/cleaner option since this one requires modifying some core files of CI.</p></blockquote>
<p>So here are the steps.</p>
<p>1. Check the server if it has Ioncube Loader installed. This can be done by putting a php script in the webserver with the following code on it:</p>
<pre lang="php">
<?php phpinfo(); ?>
</pre>
<p>Look for this particular area (or you can do a search of "Zend Scripting Language Engine")</p>
<p><img src="assets/zend_setting.png" alt="zend_setting" width="653" height="101" class="aligncenter size-full wp-image-1091" /></p>
<p>see that "ionCube PHP Loader v4.4.3" part? that indicates that IonCube is already installed. That needs to be installed since the encoder itself to be added in your application is an encoded file. Without the ionCube loader installed, the server wont be able to figure out how to execute the encoder file.</p>
<p>2. (Follow these instructions if you dont have ionCube Loader installed)</p>
<p>login to linux terminal and execute the following commands:</p>
<pre lang="bash">
cd /usr/local
sudo wget http://downloads3.ioncube.com/loader_downloads/ioncube_loaders_lin_x86-64.tar.gz
sudo tar xzf ioncube_loaders_lin_x86-64.tar.gz
</pre>
<p>Check the module is added and enabled in the php configuration file by :</p>
<pre lang="bash">
sudo cat /etc/php5/conf.d/ioncube.ini
</pre>
<p>You should see this in there</p>
<pre lang="bash">
zend_extension=/usr/local/ioncube/ioncube_loader_lin_5.4.so
</pre>
<p>If not, then manually add that line there. Make sure you check the version number matches with your PHP version. If PHP is 5.4 then the file enabled should be  <b>ioncube_loader_lin_5.4.so</b> not <b>ioncube_loader_lin_5.3.so</b></p>
<p>Restart apache for the new settings to take effect</p>
<pre lang="bash">
sudo /etc/init.d/apache2 restart
</pre>
<p>check again the phpinfo on step 1 to make sure the ioncube is showing up now.</p>
<p>3. Download the encoder file in http://www.ioncube.com/html_encoder.php<br />
(i used the http://www.ioncube.com/html_encoder_1.9.zip)<br />
Extract it to your local disk. the encoder file is <b>html_encoder_1.9.php</b><br />
Note: that is a binary file! don't open it in a text editor since you could accidentally corrupt it.<br />
Save it on CI project on this folder  /application/hooks/</p>
<p>4. In your CodeIgniter, you need to enable hooks<br />
application/config/config.php</p>
<pre lang="php">
$config['enable_hooks'] = TRUE;
</pre>
<p>5. Then define a hook<br />
application/config/hooks.php</p>
<pre lang="php">
$hook['display_override'] = array(
				'class'    => 'IoncubeHTMLEncoder',
				'function' => 'obfuscate',
				'filename' => 'IoncubeHTMLEncoder.php',
				'filepath' => 'hooks'
				);
</pre>
<p>6.  Test the page.<br />
if you got a blank page. check the apache error log</p>
<pre lang="bash">
 sudo tail -n 10 /var/log/apache2/error.log
</pre>
<p>if you see stuffs like "Cannot use output buffering in output buffering display handlers"<br />
edit the system/core/Exceptions.php<br />
(I know you can override core classes by putting a class in the application/core instead of editing the core files, but for some reason, that didn't worked for me)<br />
Edit the lines 181 and 184 so that the ob_start and ob_end_clean is commented out</p>
<pre lang="php">
  //ob_start();
  include(APPPATH.'errors/error_php.php');
  $buffer = ob_get_contents();
  //ob_end_clean();
</pre>
<p>(I know this is a dirty way of fixing up things, that is why I call this a quickfix. Use this instructions only in case of emergency)</p>
<p>7. Reload again your CI app and see if you are not getting a blank page anymore.</p>
<p>That's all I know.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Darwin Biler's Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Darwin Biler's Blog</li>
          <li><a href="mailto:darwin@buonzz.com">darwin@buonzz.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/buonzz">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">buonzz</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/buonzz">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">buonzz</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Freelance Web Developer</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
